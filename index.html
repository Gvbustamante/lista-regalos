function reservar(id, cantidadActual) {
  const nombre = prompt("Escribe tu nombre para reservar:");
  if (!nombre) return;

  let nuevaCantidad = cantidadActual - 1;
  let disponible = nuevaCantidad > 0;

  // 1️⃣ Actualizar cantidad en la tabla regalos
  fetch(`${API_URL}?id=eq.${id}`, {
    method: 'PATCH',
    headers: headers,
    body: JSON.stringify({ cantidad: nuevaCantidad, disponible: disponible })
  })
  .then(res => {
    if(res.ok) {
      // 2️⃣ Registrar al invitado en la tabla reservas
      fetch('https://losfyembcwcqnvbzaupu.supabase.co/rest/v1/reservas', {
        method: 'POST',
        headers: headers,
        body: JSON.stringify({
          invitado: nombre,
          regalo_id: id
        })
      })
      .then(res2 => {
        if(res2.ok) {
          alert("¡Gracias " + nombre + "! Tu regalo ha sido reservado 🎉");
          location.reload();
        } else {
          alert("Error al registrar la reserva.");
        }
      });
    } else {
      alert("Error al reservar. Intenta de nuevo.");
    }
  });
}
